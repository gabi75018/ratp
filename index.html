<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Pannel de Secours - Simulation</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #1b1b1b;
        color: white;
        display: flex;
        height: 100vh;
    }
    header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: #111;
        padding: 10px;
        text-align: center;
        z-index: 10;
        border-bottom: 2px solid #333;
    }
    .container {
        display: flex;
        width: 100%;
        margin-top: 60px;
    }
    .column {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        border-right: 2px solid #333;
    }
    .column:last-child {
        border-right: none;
    }
    .call-card {
        background: #2a2a2a;
        padding: 10px;
        margin-bottom: 10px;
        border-left: 5px solid #555;
    }
    .btn {
        padding: 6px 10px;
        margin: 3px;
        background: #444;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 12px;
    }
    .btn:hover {
        background: #666;
    }
    .service-btn {
        background: #0055aa;
    }
    .service-btn:hover {
        background: #0077dd;
    }
    textarea, input, select {
        width: 100%;
        background: #222;
        color: white;
        border: 1px solid #444;
        padding: 5px;
        margin-bottom: 5px;
        font-size: 12px;
    }
    textarea {
        height: 70px;
    }
    .section-title {
        font-size: 18px;
        margin-bottom: 10px;
        border-bottom: 1px solid #444;
        padding-bottom: 5px;
    }
    .small-label {
        font-size: 11px;
        color: #ccc;
    }
    .row {
        display: flex;
        gap: 5px;
    }
    .row > div {
        flex: 1;
    }
    .badge {
        display: inline-block;
        padding: 2px 6px;
        font-size: 11px;
        border-radius: 3px;
        margin-right: 4px;
    }
    .prio-P0 { background:#b30000; }
    .prio-P1 { background:#e67300; }
    .prio-P2 { background:#999900; }
    .prio-P3 { background:#555555; }
</style>
</head>
<body>

<header>
    <h2>Centre de Traitement des Appels d'Urgence â€“ Simulation</h2>
    <div id="stats"></div>
</header>

<div class="container">

    <!-- FILE D'APPELS -->
    <div class="column" id="queue">
        <div class="section-title">ðŸ“ž Appels entrants</div>
        <div id="queue-list"></div>
    </div>

    <!-- APPEL ACTIF / DOSSIER -->
    <div class="column" id="active">
        <div class="section-title">ðŸŽ§ Dossier en cours</div>
        <div id="active-call">Aucun appel sÃ©lectionnÃ©.</div>
    </div>

    <!-- ACTIONS + HISTORIQUE -->
    <div class="column">
        <div class="section-title">ðŸš¨ Actions / Dossiers envoyÃ©s</div>
        <div id="actions"></div>

        <div class="section-title" style="margin-top:20px;">ðŸ“š Historique</div>
        <div id="history"></div>
    </div>

</div>

<script>
/* ------------------------------
   SCÃ‰NARIOS DÃ‰TAILLÃ‰S
--------------------------------*/
const SCENARIOS = [
    {label:"ArrÃªt cardio-respiratoire domicile", type:"MÃ©dical", prio:"P0", desc:"Victime inconsciente, ne respire plus, Ã  domicile. Appelant trÃ¨s paniquÃ©.", victims:1, env:"Domicile"},
    {label:"Feu d'appartement avec personnes coincÃ©es", type:"Incendie", prio:"P0", desc:"FumÃ©e noire, cris Ã  l'intÃ©rieur, possible propagation aux Ã©tages supÃ©rieurs.", victims:2, env:"Immeuble"},
    {label:"Accident route â€“ choc frontal", type:"Accident", prio:"P1", desc:"Deux vÃ©hicules, un conducteur coincÃ©, airbags dÃ©clenchÃ©s, circulation bloquÃ©e.", victims:1, env:"Route"},
    {label:"Agression au couteau devant un bar", type:"Agression", prio:"P0", desc:"Victime au sol, saignement abondant, agresseur en fuite, foule autour.", victims:1, env:"Voie publique"},
    {label:"Vieil homme dÃ©sorientÃ© dans un parc", type:"MÃ©dical", prio:"P2", desc:"Ne sait plus oÃ¹ il habite, mÃ©tÃ©o froide, marche difficile.", victims:1, env:"Parc"},
    {label:"Odeur de gaz cage d'escalier", type:"Risque", prio:"P1", desc:"Odeur forte au 3e Ã©tage, voisins inquiets, pas de flamme visible.", victims:0, env:"Immeuble"},
    {label:"Appel bizarre: parle d'OVNI sur le toit", type:"Bizarre", prio:"P3", desc:"Personne dit qu'un vaisseau l'observe, discours dÃ©cousu, refuse de donner son nom.", victims:0, env:"Immeuble"},
    {label:"Enfant qui rigole et raccroche", type:"Douteux", prio:"P3", desc:"Voix d'enfant, bruits de fond TV, aucun dÃ©tail donnÃ©.", victims:0, env:"Domicile"},
    {label:"Tentative de suicide sur pont", type:"Critique", prio:"P0", desc:"Personne sur le rebord, pleure, parle de tout arrÃªter.", victims:1, env:"Pont"},
    {label:"Gros malaise dans le mÃ©tro", type:"MÃ©dical", prio:"P1", desc:"Victime au sol, respiration difficile, rame Ã  quai, foule dense.", victims:1, env:"Transport"},
    {label:"Voisin hurle qu'il est un poulet", type:"Bizarre", prio:"P3", desc:"Crie depuis 20 minutes, bruits de casseroles, possible trouble psy.", victims:0, env:"Immeuble"},
    {label:"Course poursuite scooter avec casque", type:"Police", prio:"P1", desc:"Scooter Ã  vive allure, zigzague entre voitures, refuse de s'arrÃªter.", victims:0, env:"Route"},
    {label:"Trafic suspect prÃ¨s d'un entrepÃ´t", type:"Douanes", prio:"P2", desc:"Camionnettes qui chargent/dÃ©chargent de nuit, plaques Ã©trangÃ¨res.", victims:0, env:"Zone industrielle"},
    {label:"Bagarre gÃ©nÃ©rale devant une boÃ®te de nuit", type:"Agression", prio:"P1", desc:"Plusieurs personnes impliquÃ©es, bouteilles cassÃ©es, cris, possible blessÃ©s.", victims:2, env:"Voie publique"},
    {label:"Chute grave d'un toit", type:"Accident", prio:"P0", desc:"Personne tombÃ©e de plusieurs mÃ¨tres, inconsciente, saignement tÃªte.", victims:1, env:"Chantier"},
    {label:"Crise d'Ã©pilepsie dans un supermarchÃ©", type:"MÃ©dical", prio:"P1", desc:"Convulsions en cours, sol dur, foule autour, pas de mÃ©decin sur place.", victims:1, env:"Lieu public"},
    {label:"Personne enfermÃ©e dans ascenseur", type:"Risque", prio:"P2", desc:"BloquÃ© depuis 20 minutes, commence Ã  paniquer, pas de blessure.", victims:1, env:"Immeuble"},
    {label:"Appel trÃ¨s confus, parle de complot", type:"Bizarre", prio:"P3", desc:"Parle de camÃ©ras cachÃ©es, refuse de donner localisation exacte.", victims:0, env:"Inconnu"},
    {label:"Violences conjugales suspectÃ©es", type:"Police", prio:"P1", desc:"Voisin entend des cris, bruits de coups, enfants qui pleurent.", victims:1, env:"Domicile"},
    {label:"Intoxication alcool + chute", type:"MÃ©dical", prio:"P2", desc:"Personne trÃ¨s alcoolisÃ©e, chute dans escalier, plaie Ã  la tÃªte.", victims:1, env:"Domicile"}
];

/* ------------------------------
   VARIABLES
--------------------------------*/
let queue = [];
let activeCall = null;
let actions = [];
let history = [];
let callID = 1;

/* ------------------------------
   GENERATEUR D'APPELS
--------------------------------*/
function generateCall() {
    const s = SCENARIOS[Math.floor(Math.random()*SCENARIOS.length)];
    const call = {
        id: callID++,
        scenario: s,
        time: new Date().toLocaleTimeString(),
        location: randomLocation(),
        comments: [],
        services: [],
        status: "En attente",
        dossierSent: false,
        // champs dossier
        callerName: "",
        callerPhone: "",
        freeDesc: "",
        gravity: s.prio,
        env: s.env,
        alcoholDrugs: "Inconnu",
        weaponPresent: "Inconnu",
        childrenInvolved: "Inconnu",
        suspectedHoax: "Non",
        dangerOngoing: "Inconnu",
        safetyForRescuers: "Inconnu"
    };
    queue.push(call);
    renderQueue();
}

function randomLocation() {
    const streets = ["Rue Victor Hugo", "Avenue de Paris", "Boulevard des Lilas", "Rue du Port", "Chemin des Vignes", "Rue de la Gare", "Place de la RÃ©publique"];
    const cities = ["Paris", "Lyon", "Marseille", "Toulouse", "Lille", "Nantes", "Bordeaux"];
    return streets[Math.floor(Math.random()*streets.length)] + " " + (Math.floor(Math.random()*120)+1) + ", " + cities[Math.floor(Math.random()*cities.length)];
}

/* ------------------------------
   AFFICHAGE FILE D'APPELS
--------------------------------*/
function renderQueue() {
    const div = document.getElementById("queue-list");
    div.innerHTML = "";
    queue.forEach(call => {
        div.innerHTML += `
            <div class="call-card">
                <b>#${call.id}</b> â€“ ${call.scenario.label}<br>
                <span class="badge prio-${call.scenario.prio}">${call.scenario.prio}</span>
                <span class="small-label">${call.scenario.type}</span><br>
                ${call.location}<br>
                <span class="small-label">ReÃ§u Ã  ${call.time}</span><br>
                <button class="btn" onclick="takeCall(${call.id})">Prendre en charge</button>
            </div>
        `;
    });
}

/* ------------------------------
   PRENDRE UN APPEL
--------------------------------*/
function takeCall(id) {
    activeCall = queue.find(c => c.id === id);
    queue = queue.filter(c => c.id !== id);
    renderQueue();
    renderActiveCall();
}

/* ------------------------------
   AFFICHAGE APPEL / DOSSIER ACTIF
--------------------------------*/
function renderActiveCall() {
    if (!activeCall) {
        document.getElementById("active-call").innerHTML = "Aucun appel sÃ©lectionnÃ©.";
        return;
    }

    const c = activeCall;
    const disabledCore = c.dossierSent ? "disabled" : "";

    document.getElementById("active-call").innerHTML = `
        <div class="call-card">
            <h3>Dossier #${c.id} ${c.dossierSent ? "(envoyÃ© â€“ modifiable)" : "(Ã  complÃ©ter)"}</h3>
            <div class="small-label">ReÃ§u Ã  ${c.time} â€“ ${c.location}</div>
            <b>${c.scenario.label}</b><br>
            Type : ${c.scenario.type} â€“ 
            <span class="badge prio-${c.scenario.prio}">${c.scenario.prio}</span><br>
            Victimes estimÃ©es : ${c.scenario.victims} â€“ Environnement: ${c.scenario.env}<br>
            <p>${c.scenario.desc}</p>

            <h4>1. Informations appelant</h4>
            <label class="small-label">Nom / IdentitÃ© (obligatoire)</label>
            <input ${disabledCore} id="callerName" value="${c.callerName}">
            <label class="small-label">TÃ©lÃ©phone (obligatoire)</label>
            <input ${disabledCore} id="callerPhone" value="${c.callerPhone}">

            <h4>2. Description libre (obligatoire)</h4>
            <textarea ${disabledCore} id="freeDesc">${c.freeDesc}</textarea>

            <h4>3. Ã‰valuation rapide</h4>
            <div class="row">
                <div>
                    <label class="small-label">GravitÃ© perÃ§ue</label>
                    <select id="gravity" ${disabledCore}>
                        ${["P0","P1","P2","P3"].map(p=>`<option value="${p}" ${c.gravity===p?"selected":""}>${p}</option>`).join("")}
                    </select>
                </div>
                <div>
                    <label class="small-label">Environnement</label>
                    <select id="env" ${disabledCore}>
                        ${["Domicile","Immeuble","Voie publique","Route","Parc","Transport","Zone industrielle","Lieu public","Chantier","Inconnu"].map(e=>`<option value="${e}" ${c.env===e?"selected":""}>${e}</option>`).join("")}
                    </select>
                </div>
            </div>

            <div class="row">
                <div>
                    <label class="small-label">Alcool / Drogues</label>
                    <select id="alcoholDrugs" ${disabledCore}>
                        ${["Inconnu","Oui suspectÃ©","Non"].map(v=>`<option value="${v}" ${c.alcoholDrugs===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
                <div>
                    <label class="small-label">Arme prÃ©sente</label>
                    <select id="weaponPresent" ${disabledCore}>
                        ${["Inconnu","Oui","Non"].map(v=>`<option value="${v}" ${c.weaponPresent===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
            </div>

            <div class="row">
                <div>
                    <label class="small-label">Enfants impliquÃ©s</label>
                    <select id="childrenInvolved" ${disabledCore}>
                        ${["Inconnu","Oui","Non"].map(v=>`<option value="${v}" ${c.childrenInvolved===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
                <div>
                    <label class="small-label">Canular suspectÃ©</label>
                    <select id="suspectedHoax" ${disabledCore}>
                        ${["Non","Oui"].map(v=>`<option value="${v}" ${c.suspectedHoax===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
            </div>

            <div class="row">
                <div>
                    <label class="small-label">Danger toujours prÃ©sent ?</label>
                    <select id="dangerOngoing" ${disabledCore}>
                        ${["Inconnu","Oui","Non"].map(v=>`<option value="${v}" ${c.dangerOngoing===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
                <div>
                    <label class="small-label">SÃ©curitÃ© des secours</label>
                    <select id="safetyForRescuers" ${disabledCore}>
                        ${["Inconnu","OK","Risque"].map(v=>`<option value="${v}" ${c.safetyForRescuers===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
            </div>

            <h4>4. Commentaires opÃ©rateur</h4>
            <textarea id="comment"></textarea>
            <button class="btn" onclick="addComment()">Ajouter commentaire</button>
            <div id="comment-list">${c.comments.map(cm=>"<div>â€¢ "+cm+"</div>").join("")}</div>

            <h4>5. Services Ã  engager</h4>
            ${serviceButton("SAMU")}
            ${serviceButton("Pompiers")}
            ${serviceButton("Police")}
            ${serviceButton("Gendarmerie")}
            ${serviceButton("SMUR")}
            ${serviceButton("HÃ©lico")}
            ${serviceButton("DOC")}
            ${serviceButton("Douanes")}

            <h4>6. Validation du dossier</h4>
            <button class="btn" onclick="saveCoreFields()">ðŸ’¾ Sauvegarder les infos</button>
            <button class="btn" onclick="sendDossier()" ${c.dossierSent ? "" : ""}>ðŸ“¤ Envoyer le dossier</button>
            <button class="btn" onclick="closeCall()">âœ… ClÃ´turer le dossier</button>
        </div>
    `;
}

function serviceButton(name) {
    return `<button class="btn service-btn" onclick="sendService('${name}')">${name}</button>`;
}

/* ------------------------------
   SAUVEGARDE DES CHAMPS DOSSIER
--------------------------------*/
function saveCoreFields() {
    if (!activeCall) return;
    const c = activeCall;
    c.callerName = document.getElementById("callerName").value.trim();
    c.callerPhone = document.getElementById("callerPhone").value.trim();
    c.freeDesc = document.getElementById("freeDesc").value.trim();
    c.gravity = document.getElementById("gravity").value;
    c.env = document.getElementById("env").value;
    c.alcoholDrugs = document.getElementById("alcoholDrugs").value;
    c.weaponPresent = document.getElementById("weaponPresent").value;
    c.childrenInvolved = document.getElementById("childrenInvolved").value;
    c.suspectedHoax = document.getElementById("suspectedHoax").value;
    c.dangerOngoing = document.getElementById("dangerOngoing").value;
    c.safetyForRescuers = document.getElementById("safetyForRescuers").value;
    alert("Dossier sauvegardÃ© (modifiable tant qu'il n'est pas clÃ´turÃ©).");
}

/* ------------------------------
   ENVOI DU DOSSIER
--------------------------------*/
function sendDossier() {
    if (!activeCall) return;
    const c = activeCall;

    // VÃ©rif champs obligatoires
    const name = document.getElementById("callerName").value.trim();
    const phone = document.getElementById("callerPhone").value.trim();
    const desc = document.getElementById("freeDesc").value.trim();
    if (!name || !phone || !desc) {
        alert("Merci de remplir au minimum : Nom appelant, TÃ©lÃ©phone, Description libre.");
        return;
    }

    saveCoreFields();
    c.dossierSent = true;

    // Ajouter dans la liste des actions/dossiers envoyÃ©s si pas dÃ©jÃ 
    if (!actions.find(a => a.id === c.id)) {
        actions.push({
            id: c.id,
            label: c.scenario.label,
            time: new Date().toLocaleTimeString(),
            services: [...c.services]
        });
    } else {
        // mettre Ã  jour services
        const a = actions.find(a => a.id === c.id);
        a.services = [...c.services];
    }

    renderActions();
    renderActiveCall();
}

/* ------------------------------
   COMMENTAIRES
--------------------------------*/
function addComment() {
    if (!activeCall) return;
    const txt = document.getElementById("comment").value.trim();
    if (!txt) return;
    activeCall.comments.push(txt);
    document.getElementById("comment").value = "";
    renderActiveCall();
}

/* ------------------------------
   ENVOI DE SERVICES
--------------------------------*/
function sendService(s) {
    if (!activeCall) return;
    activeCall.services.push(s);
    // si dossier dÃ©jÃ  envoyÃ©, mettre Ã  jour actions
    if (activeCall.dossierSent) {
        const a = actions.find(a => a.id === activeCall.id);
        if (a) a.services = [...activeCall.services];
        else actions.push({id: activeCall.id, label: activeCall.scenario.label, time:new Date().toLocaleTimeString(), services:[...activeCall.services]});
        renderActions();
    }
    renderActiveCall();
}

function renderActions() {
    const div = document.getElementById("actions");
    div.innerHTML = actions.map(a => `
        <div class="call-card">
            <b>Dossier #${a.id}</b> â€“ ${a.label}<br>
            <span class="small-label">EnvoyÃ© Ã  ${a.time}</span><br>
            Services engagÃ©s : ${a.services.length ? a.services.join(", ") : "Aucun pour l'instant"}
        </div>
    `).join("");
}

/* ------------------------------
   CLÃ”TURE APPEL
--------------------------------*/
function closeCall() {
    if (!activeCall) return;
    history.push(activeCall);
    // retirer des actions si prÃ©sent
    actions = actions.filter(a => a.id !== activeCall.id);
    activeCall = null;
    renderActiveCall();
    renderActions();
    renderHistory();
}

function renderHistory() {
    const div = document.getElementById("history");
    div.innerHTML = history.map(h => `
        <div class="call-card">
            <b>#${h.id}</b> â€“ ${h.scenario.label}<br>
            GravitÃ© finale : ${h.gravity} â€“ Environnement : ${h.env}<br>
            Services envoyÃ©s : ${h.services.join(", ") || "Aucun"}<br>
            Commentaires : ${h.comments.length}<br>
            Appelant : ${h.callerName || "Inconnu"} (${h.callerPhone || "N/A"})
        </div>
    `).join("");
}

/* ------------------------------
   STATISTIQUES
--------------------------------*/
setInterval(() => {
    document.getElementById("stats").innerHTML =
        `Appels en attente: ${queue.length} | Dossier en cours: ${activeCall ? "#"+activeCall.id : "aucun"} | Dossiers envoyÃ©s: ${actions.length} | Historique: ${history.length}`;
}, 500);

/* ------------------------------
   LANCEMENT AUTOMATIQUE
   (dÃ©bit augmentÃ© : ~6â€“10s)
--------------------------------*/
setInterval(() => generateCall(), 6000 + Math.random()*4000);

</script>

</body>
</html>

