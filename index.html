<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Pannel de Secours - Simulation</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #1b1b1b;
        color: white;
        display: flex;
        height: 100vh;
    }
    header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: #111;
        padding: 10px;
        text-align: center;
        z-index: 10;
        border-bottom: 2px solid #333;
    }
    .container {
        display: flex;
        width: 100%;
        margin-top: 60px;
    }
    .column {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        border-right: 2px solid #333;
    }
    .column:last-child {
        border-right: none;
    }
    .call-card {
        background: #2a2a2a;
        padding: 10px;
        margin-bottom: 10px;
        border-left: 5px solid #555;
    }
    .btn {
        padding: 6px 10px;
        margin: 3px;
        background: #444;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 12px;
    }
    .btn:hover {
        background: #666;
    }
    .service-btn {
        background: #0055aa;
    }
    .service-btn:hover {
        background: #0077dd;
    }
    textarea, input, select {
        width: 100%;
        background: #222;
        color: white;
        border: 1px solid #444;
        padding: 5px;
        margin-bottom: 5px;
        font-size: 12px;
    }
    textarea {
        height: 70px;
    }
    .section-title {
        font-size: 18px;
        margin-bottom: 10px;
        border-bottom: 1px solid #444;
        padding-bottom: 5px;
    }
    .small-label {
        font-size: 11px;
        color: #ccc;
    }
    .row {
        display: flex;
        gap: 5px;
    }
    .row > div {
        flex: 1;
    }
    .badge {
        display: inline-block;
        padding: 2px 6px;
        font-size: 11px;
        border-radius: 3px;
        margin-right: 4px;
    }
    .prio-P0 { background:#b30000; }
    .prio-P1 { background:#e67300; }
    .prio-P2 { background:#999900; }
    .prio-P3 { background:#555555; }
</style>
</head>
<body>

<header>
    <h2>Centre de Traitement des Appels d'Urgence â€“ Simulation</h2>
    <div id="stats"></div>
</header>

<div class="container">

    <!-- FILE D'APPELS -->
    <div class="column" id="queue">
        <div class="section-title">ðŸ“ž Appels entrants</div>
        <div id="queue-list"></div>
    </div>

    <!-- APPEL ACTIF / DOSSIER -->
    <div class="column" id="active">
        <div class="section-title">ðŸŽ§ Dossier en cours</div>
        <div id="active-call">Aucun appel sÃ©lectionnÃ©.</div>
    </div>

    <!-- ACTIONS + HISTORIQUE -->
    <div class="column">
        <div class="section-title">ðŸš¨ Dossiers envoyÃ©s</div>
        <div id="actions"></div>

        <div class="section-title" style="margin-top:20px;">ðŸ“š Historique</div>
        <div id="history"></div>
    </div>

</div>

<script>
/* ------------------------------
   SCÃ‰NARIOS DÃ‰TAILLÃ‰S
--------------------------------*/
const SCENARIOS = [
    {label:"ArrÃªt cardio-respiratoire", type:"MÃ©dical", prio:"P0", desc:"Victime inconsciente, respiration absente.", victims:1, env:"Domicile"},
    {label:"Feu d'appartement", type:"Incendie", prio:"P0", desc:"FumÃ©e noire, personnes coincÃ©es.", victims:2, env:"Immeuble"},
    {label:"Accident frontal", type:"Accident", prio:"P1", desc:"Deux voitures, un coincÃ©.", victims:1, env:"Route"},
    {label:"Agression couteau", type:"Agression", prio:"P0", desc:"Victime poignardÃ©e, saigne abondamment.", victims:1, env:"Voie publique"},
    {label:"Vieil homme perdu", type:"MÃ©dical", prio:"P2", desc:"Confusion, marche instable.", victims:1, env:"Parc"},
    {label:"Odeur de gaz", type:"Risque", prio:"P1", desc:"Odeur forte dans immeuble.", victims:0, env:"Immeuble"},
    {label:"OVNI sur le toit", type:"Bizarre", prio:"P3", desc:"Personne dit Ãªtre observÃ©e.", victims:0, env:"Immeuble"},
    {label:"Enfant qui rigole", type:"Douteux", prio:"P3", desc:"Probable canular.", victims:0, env:"Domicile"},
    {label:"Suicide pont", type:"Critique", prio:"P0", desc:"Personne sur rebord.", victims:1, env:"Pont"},
    {label:"Malaise mÃ©tro", type:"MÃ©dical", prio:"P1", desc:"Victime au sol, respiration difficile.", victims:1, env:"Transport"},
    {label:"Voisin se prend pour un poulet", type:"Bizarre", prio:"P3", desc:"Crie depuis 20 minutes.", victims:0, env:"Immeuble"},
    {label:"Course poursuite scooter", type:"Police", prio:"P1", desc:"Scooter refuse d'obtempÃ©rer.", victims:0, env:"Route"},
    {label:"Trafic suspect", type:"Douanes", prio:"P2", desc:"Chargements nocturnes suspects.", victims:0, env:"Zone industrielle"},
    {label:"Bagarre gÃ©nÃ©rale", type:"Agression", prio:"P1", desc:"Plusieurs blessÃ©s possibles.", victims:2, env:"Voie publique"},
    {label:"Chute d'un toit", type:"Accident", prio:"P0", desc:"Victime inconsciente.", victims:1, env:"Chantier"},
    {label:"Crise d'Ã©pilepsie", type:"MÃ©dical", prio:"P1", desc:"Convulsions en cours.", victims:1, env:"Lieu public"},
    {label:"Ascenseur bloquÃ©", type:"Risque", prio:"P2", desc:"Personne enfermÃ©e, panique.", victims:1, env:"Immeuble"},
    {label:"Complot imaginaire", type:"Bizarre", prio:"P3", desc:"Parle de camÃ©ras cachÃ©es.", victims:0, env:"Inconnu"},
    {label:"Violences conjugales", type:"Police", prio:"P1", desc:"Cris, bruits de coups.", victims:1, env:"Domicile"},
    {label:"Intox alcool + chute", type:"MÃ©dical", prio:"P2", desc:"Plaie tÃªte, alcoolisÃ©.", victims:1, env:"Domicile"},
    {label:"Explosion entendue", type:"Risque", prio:"P1", desc:"DÃ©tonation forte, fumÃ©e.", victims:0, env:"Rue"},
    {label:"Cri animal Ã©trange", type:"Bizarre", prio:"P3", desc:"Appelant parle d'un monstre.", victims:0, env:"ForÃªt"},
    {label:"Fuite chimique", type:"Risque", prio:"P0", desc:"Odeur piquante, irritation yeux.", victims:1, env:"Usine"}
];

/* ------------------------------
   VARIABLES
--------------------------------*/
let queue = [];
let activeCall = null;
let actions = [];
let history = [];
let callID = 1;

/* ------------------------------
   GENERATEUR D'APPELS
--------------------------------*/
function generateCall() {
    const s = SCENARIOS[Math.floor(Math.random()*SCENARIOS.length)];
    const call = {
        id: callID++,
        scenario: s,
        time: new Date().toLocaleTimeString(),
        location: randomLocation(),
        comments: [],
        services: [],
        dossierSent: false,
        // Champs libres
        freeDesc: "",
        gravity: s.prio,
        env: s.env,
        alcoholDrugs: "Inconnu",
        weaponPresent: "Inconnu",
        childrenInvolved: "Inconnu",
        suspectedHoax: "Non",
        dangerOngoing: "Inconnu",
        safetyForRescuers: "Inconnu"
    };
    queue.push(call);
    renderQueue();
}

function randomLocation() {
    const streets = ["Rue Victor Hugo","Avenue de Paris","Boulevard des Lilas","Rue du Port","Chemin des Vignes","Rue de la Gare","Place RÃ©publique"];
    const cities = ["Paris","Lyon","Marseille","Toulouse","Lille","Nantes","Bordeaux"];
    return streets[Math.floor(Math.random()*streets.length)] + " " + (Math.floor(Math.random()*120)+1) + ", " + cities[Math.floor(Math.random()*cities.length)];
}

/* ------------------------------
   AFFICHAGE FILE D'APPELS
--------------------------------*/
function renderQueue() {
    const div = document.getElementById("queue-list");
    div.innerHTML = "";
    queue.forEach(call => {
        div.innerHTML += `
            <div class="call-card">
                <b>#${call.id}</b> â€“ ${call.scenario.label}<br>
                <span class="badge prio-${call.scenario.prio}">${call.scenario.prio}</span>
                <span class="small-label">${call.scenario.type}</span><br>
                ${call.location}<br>
                <span class="small-label">ReÃ§u Ã  ${call.time}</span><br>
                <button class="btn" onclick="takeCall(${call.id})">Prendre en charge</button>
            </div>
        `;
    });
}

/* ------------------------------
   PRENDRE UN APPEL
--------------------------------*/
function takeCall(id) {
    activeCall = queue.find(c => c.id === id);
    queue = queue.filter(c => c.id !== id);
    renderQueue();
    renderActiveCall();
}

/* ------------------------------
   AFFICHAGE DOSSIER
--------------------------------*/
function renderActiveCall() {
    if (!activeCall) {
        document.getElementById("active-call").innerHTML = "Aucun appel sÃ©lectionnÃ©.";
        return;
    }

    const c = activeCall;

    document.getElementById("active-call").innerHTML = `
        <div class="call-card">
            <h3>Dossier #${c.id} ${c.dossierSent ? "(envoyÃ© â€“ modifiable)" : "(Ã  complÃ©ter)"}</h3>
            <div class="small-label">ReÃ§u Ã  ${c.time} â€“ ${c.location}</div>
            <b>${c.scenario.label}</b><br>
            Type : ${c.scenario.type} â€“ 
            <span class="badge prio-${c.scenario.prio}">${c.scenario.prio}</span><br>
            Victimes estimÃ©es : ${c.scenario.victims}<br>
            <p>${c.scenario.desc}</p>

            <h4>Description libre</h4>
            <textarea id="freeDesc">${c.freeDesc}</textarea>

            <h4>Ã‰valuation</h4>
            <div class="row">
                <div>
                    <label class="small-label">GravitÃ©</label>
                    <select id="gravity">
                        ${["P0","P1","P2","P3"].map(p=>`<option value="${p}" ${c.gravity===p?"selected":""}>${p}</option>`).join("")}
                    </select>
                </div>
                <div>
                    <label class="small-label">Environnement</label>
                    <select id="env">
                        ${["Domicile","Immeuble","Voie publique","Route","Parc","Transport","Zone industrielle","Lieu public","Chantier","Inconnu"].map(e=>`<option value="${e}" ${c.env===e?"selected":""}>${e}</option>`).join("")}
                    </select>
                </div>
            </div>

            <div class="row">
                <div>
                    <label class="small-label">Alcool / Drogues</label>
                    <select id="alcoholDrugs">
                        ${["Inconnu","Oui suspectÃ©","Non"].map(v=>`<option value="${v}" ${c.alcoholDrugs===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
                <div>
                    <label class="small-label">Arme prÃ©sente</label>
                    <select id="weaponPresent">
                        ${["Inconnu","Oui","Non"].map(v=>`<option value="${v}" ${c.weaponPresent===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
            </div>

            <div class="row">
                <div>
                    <label class="small-label">Enfants impliquÃ©s</label>
                    <select id="childrenInvolved">
                        ${["Inconnu","Oui","Non"].map(v=>`<option value="${v}" ${c.childrenInvolved===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
                <div>
                    <label class="small-label">Canular suspectÃ©</label>
                    <select id="suspectedHoax">
                        ${["Non","Oui"].map(v=>`<option value="${v}" ${c.suspectedHoax===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
            </div>

            <div class="row">
                <div>
                    <label class="small-label">Danger persistant</label>
                    <select id="dangerOngoing">
                        ${["Inconnu","Oui","Non"].map(v=>`<option value="${v}" ${c.dangerOngoing===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
                <div>
                    <label class="small-label">SÃ©curitÃ© des secours</label>
                    <select id="safetyForRescuers">
                        ${["Inconnu","OK","Risque"].map(v=>`<option value="${v}" ${c.safetyForRescuers===v?"selected":""}>${v}</option>`).join("")}
                    </select>
                </div>
            </div>

            <h4>Commentaires opÃ©rateur</h4>
            <textarea id="comment"></textarea>
            <button class="btn" onclick="addComment()">Ajouter commentaire</button>
            <div id="comment-list">${c.comments.map(cm=>"<div>â€¢ "+cm+"</div>").join("")}</div>

            <h4>Services Ã  engager</h4>
            ${serviceButton("SAMU")}
            ${serviceButton("Pompiers")}
            ${serviceButton("Police")}
            ${serviceButton("Gendarmerie")}
            ${serviceButton("SMUR")}
            ${serviceButton("HÃ©lico")}
            ${serviceButton("DOC")}
            ${serviceButton("Douanes")}

            <h4>Validation</h4>
            <button class="btn" onclick="saveCoreFields()">ðŸ’¾ Sauvegarder</button>
            <button class="btn" onclick="sendDossier()">ðŸ“¤ Envoyer dossier</button>
            <button class="btn" onclick="closeCall()">âœ… ClÃ´turer</button>
        </div>
    `;
}

function serviceButton(name) {
    return `<button class="btn service-btn" onclick="sendService('${name}')">${name}</button>`;
}

/* ------------------------------
   SAUVEGARDE
--------------------------------*/
function saveCoreFields() {
    if (!activeCall) return;
    const c = activeCall;
    c.freeDesc = document.getElementById("freeDesc").value;
    c.gravity = document.getElementById("gravity").value;
    c.env = document.getElementById("env").value;
    c.alcoholDrugs = document.getElementById("alcoholDrugs").value;
    c.weaponPresent = document.getElementById("weaponPresent").value;
    c.childrenInvolved = document.getElementById("childrenInvolved").value;
    c.suspectedHoax = document.getElementById("suspectedHoax").value;
    c.dangerOngoing = document.getElementById("dangerOngoing").value;
    c.safetyForRescuers = document.getElementById("safetyForRescuers").value;
}

/* ------------------------------
   ENVOI DU DOSSIER
--------------------------------*/
function sendDossier() {
    if (!activeCall) return;
    saveCoreFields();
    activeCall.dossierSent = true;

    const existing = actions.find(a => a.id === activeCall.id);
    if (!existing) {
        actions.push({
            id: activeCall.id,
            label: activeCall.scenario.label,
            time: new Date().toLocaleTimeString(),
            services: [...activeCall.services]
        });
    }
    renderActions();
    renderActiveCall();
}

/* ------------------------------
   COMMENTAIRES
--------------------------------*/
function addComment() {
    if (!activeCall) return;
    const txt = document.getElementById("comment").value.trim();
    if (!txt) return;
    activeCall.comments.push(txt);
    document.getElementById("comment").value = "";
    renderActiveCall

